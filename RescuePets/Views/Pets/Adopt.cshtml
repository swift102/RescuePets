@model RescuePets.Controllers.PetsController.AdoptViewModel
@{
    ViewBag.Title = "Adopt " + Model.Pet.PetName;
}

<div class="row">
    <div class="col-lg-6 mb-4">
        <div class="card">
            @if (!string.IsNullOrEmpty(Model.Pet.ImageData))
            {
                <img src="data:image/jpeg;base64,@Model.Pet.ImageData" alt="@Model.Pet.PetName" class="card-img-top" style="height: 400px; object-fit: cover;">
            }
            else
            {
                <div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 400px;">
                    <i class="fas fa-camera fa-4x text-muted"></i>
                </div>
            }

            <div class="card-body">
                <h2 class="card-title text-center">@Model.Pet.PetName</h2>
                <div class="text-center mb-3">
                    <span class="status-available">Available for Adoption</span>
                </div>

                <div class="row text-center">
                    <div class="col-6 col-md-3 mb-2">
                        <div class="p-2">
                            <i class="fas fa-map-marker-alt text-primary"></i>
                            <small class="d-block font-weight-bold">Location</small>
                            <small>@Model.Pet.Location.LocationName</small>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-2">
                        <div class="p-2">
                            <i class="fas fa-birthday-cake text-primary"></i>
                            <small class="d-block font-weight-bold">Age</small>
                            <small>@Model.Pet.Age years</small>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-2">
                        <div class="p-2">
                            <i class="fas fa-weight text-primary"></i>
                            <small class="d-block font-weight-bold">Weight</small>
                            <small>@Model.Pet.Weight kg</small>
                        </div>
                    </div>
                    <div class="col-6 col-md-3 mb-2">
                        <div class="p-2">
                            <i class="fas fa-venus-mars text-primary"></i>
                            <small class="d-block font-weight-bold">Gender</small>
                            <small>@Model.Pet.Gender.GenderName</small>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-3">
                    <span class="badge badge-info mr-2">@Model.Pet.PetType.TypeName</span>
                    <span class="badge badge-secondary">@Model.Pet.PetBreed.BreedName</span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card mb-4">
            <div class="card-header">
                <h4 class="mb-0"><i class="fas fa-book-open"></i> Pet Story</h4>
            </div>
            <div class="card-body">
                <p>@Model.Pet.PetStory</p>
                <hr>
                <small class="text-muted">
                    <i class="fas fa-user"></i> Posted by @Model.Pet.User.FirstName @Model.Pet.User.LastName
                    <br>
                    <i class="fas fa-calendar"></i> @Model.Pet.DatePosted.ToString("MMMM dd, yyyy")
                </small>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="fas fa-heart"></i> Adoption Form</h4>
            </div>
            <div class="card-body">
                @using (Html.BeginForm("Adopt", "Pets", FormMethod.Post, new { @class = "needs-validation", novalidate = "novalidate" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("petId", Model.Pet.PetID)

                    <div class="form-group">
                        <label for="adopterId">Your Name <span class="text-danger">*</span></label>
                        @Html.DropDownList("adopterId", Model.Users, "Select your name...", new { @class = "form-control", @id = "userDropdown", required = "required" })
                        <div class="invalid-feedback">
                            Please select your name.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="phoneNumber">Phone Number</label>
                        <input type="text" class="form-control" id="phoneNumber" readonly placeholder="Select your name first">
                    </div>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        By clicking "Adopt Now", you confirm that you are ready to provide a loving home for @Model.Pet.PetName.
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg btn-block" id="adoptBtn" disabled>
                        <i class="fas fa-heart"></i> Adopt Now
                    </button>
                }

                <div class="text-center mt-3">
                    <a href="@Url.Action(" Index", "Pets" )" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Pets
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
    $(document).ready(function () {
        // Update phone number when user changes
        $('#userDropdown').change(function () {
            var userId = $(this).val();

            if (userId && userId !== '') {
                $.ajax({
                    url: '@Url.Action("GetPhoneByUser", "Pets")',
                    type: 'GET',
                    data: { userId: userId },
                    success: function (data) {
                        $('#phoneNumber').val(data.phoneNumber);
                        $('#adoptBtn').prop('disabled', false);
                    }
                });
            } else {
                $('#phoneNumber').val('');
                $('#adoptBtn').prop('disabled', true);
            }
        });

        // Form validation
        $('.needs-validation').on('submit', function (event) {
            if (this.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
            }
            $(this).addClass('was-validated');
        });
    });
    </script>
}